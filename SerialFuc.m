function SerialFuc()        % 创建函数  
  delete(instrfindall)      % 关闭串口，此句十分重要，下篇再详细解释  
  global s a fid;% 全局变量，供串口中断函数使用  
  a=[];
  format short g
  fid = fopen('Data3.txt','a+')
  s = serial('com5');       %使用默认设置创建串口s  
  set(s,'BaudRate',115200);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  set(s,'InputBufferSize',1024000);%%%设置输入缓冲区大小为1
  set(s,'BytesAvailableFcnMode','byte'); %设置中断触发方式  
  set(s,'BytesAvailableFcnCount',660); %设置中断触发方式  
  s.BytesAvailableFcn =@ReceiveCallback;       % 定义中断响应函数对象  
  fopen(s);                 %打开串口  
  
  
%  fclose(s);            % 关闭串口
%  delete(s);           % 释放串口对象占用的内存空间,
%  clear s;  
end
function ReceiveCallback( obj,event)     %创建中断响应函数  
   global s a fid;  
  
   str = fread(s);%读取数据
   hex=dec2hex(str)
  a=[];IMU_data = [];Motion_data=[];
  sign_head1=hex2dec('A5');sign_head2 = hex2dec('5A');
  sign_finish=hex2dec('AA');sign_IMU=hex2dec('A1');sign_Motion=hex2dec('A2');

  a= [a;str];
  j=1;
  while (~isempty(a))
        if j>size(a,1)
           break;
        end
        if a(j)==sign_head1 && a(j+1) == sign_head2 
            if (j+a(j+2)+1) > size(a,1) 
                break;
            end
            index_start = j+2;
            index_finish= index_start + a(j+2)-1;
            pack = a(index_start:index_finish);
            if ~isempty(pack) &&pack(pack(1))== sign_finish
                  if pack(2) == sign_IMU
                        IMU_data(1,:) = Get_IMU(pack);
                        j = index_finish;
                        continue;
                  end
                   if pack(2) ==sign_Motion
                          Motion_data(1,:) = Get_Motion(pack);
                          j = index_finish;
                   end
                   if ~isempty(IMU_data) && ~isempty(Motion_data)
                        act_data = [IMU_data,Motion_data]
                        fprintf(fid,'%8.1f%8.1f%8.1f%8.1f%8.1f%8.1f%8d%8d%8d%8d%8d%8d%8d%8d%8d\n',act_data);
                        Motion_data=[];IMU_data=[];
                        a(1:index_finish)=[];
                         j=1;
                    end
                 end
            else
                j=j+1;
        end    
  end  
end